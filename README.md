# D5Collect - è°éŸ³å­—çš®è‚¤æŸ¥è¯¢å·¥å…·

D5Collect æ˜¯ä¸€ä¸ªåŸºäº Flask å¼€å‘çš„ Web åº”ç”¨ï¼Œä¸“ä¸ºã€Šç¬¬äº”äººæ ¼ã€‹æ¸¸æˆç©å®¶è®¾è®¡ã€‚å®ƒèƒ½æ ¹æ®ç”¨æˆ·è¾“å…¥çš„æ±‰å­—æˆ–å­—æ¯ï¼Œåˆ©ç”¨æ‹¼éŸ³åŒ¹é…åŸç†ï¼Œå¿«é€ŸæŸ¥æ‰¾å…·æœ‰ç›¸ä¼¼å‘éŸ³é¦–å­—çš„æ¸¸æˆçš®è‚¤ï¼Œå¸®åŠ©ç©å®¶è½»æ¾å®ç°â€œè—å¤´è¯—â€ç­‰åˆ›æ„çš®è‚¤æ­é…ã€‚

**åœ¨çº¿ä½“éªŒ**: [ç¬¬äº”äººæ ¼è°éŸ³å­—çš®è‚¤æŸ¥è¯¢å·¥å…·](https://d5collect.narakapve.com/)

## âœ¨ åŠŸèƒ½ç‰¹ç‚¹

  * **æ ¸å¿ƒåŠŸèƒ½ - è°éŸ³åŒ¹é…**: è¾“å…¥ä»»æ„å¥å­ï¼Œå³å¯æŸ¥æ‰¾æ¯ä¸ªå­—å¯¹åº”çš„åŒéŸ³åŠè°éŸ³çš®è‚¤ã€‚
  * **ç²¾å‡†é«˜äº®**: åœ¨æœç´¢ç»“æœä¸­ï¼Œä¸è¾“å…¥å­—å®Œå…¨åŒ¹é…çš„çš®è‚¤å°†ä»¥é»„è‰²é«˜äº®çªå‡ºæ˜¾ç¤ºã€‚
  * **å¼ºå¤§ç­›é€‰**: åœ¨å®¢æˆ·ç«¯åŠ¨æ€æŒ‰**å“è´¨**å’Œ**è§’è‰²**è¿›è¡Œå¤šé‡ç­›é€‰ï¼Œæ— éœ€åˆ·æ–°é¡µé¢ã€‚
  * **ç»Ÿè®¡åå° (Dashboard)**: å†…ç½®ä¸€ä¸ªå—å¯†ç ä¿æŠ¤çš„ç»Ÿè®¡åå°ï¼Œé€šè¿‡å›¾è¡¨å’Œåˆ—è¡¨å±•ç¤ºç½‘ç«™çš„è¯¦ç»†ä½¿ç”¨æƒ…å†µï¼Œå¦‚æ€»è¯·æ±‚æ•°ã€ç‹¬ç«‹è®¿å®¢è¶‹åŠ¿ã€çƒ­é—¨IPç­‰ã€‚
  * **åŠ¨æ€åˆ·æ–°ä¸åŠ¨ç”»**: Dashboard é¡µé¢æ”¯æŒæ¯3ç§’è‡ªåŠ¨åˆ·æ–°å’Œæ‰‹åŠ¨åˆ·æ–°ï¼Œå¹¶é…æœ‰å¹³æ»‘çš„æ•°å­—å¢é•¿åŠåˆ—è¡¨é¡¹æ›´æ–°åŠ¨ç”»ã€‚
  * **è‡ªåŠ¨åŒ–æ•°æ®æ›´æ–°**: æä¾›äº†ç‹¬ç«‹çš„ Python è„šæœ¬ (`scripts/update_data.py`)ï¼Œå¯ä¸€é”®ä» Bilibili Wiki æŠ“å–æœ€æ–°çš„çš®è‚¤æ•°æ®ã€‚
  * **ç°ä»£åŒ–æŠ€æœ¯æ ˆ**: é‡‡ç”¨ Flask åº”ç”¨å·¥å‚æ¨¡å¼æ„å»ºï¼Œåç«¯é€»è¾‘æ¸…æ™°ï¼Œå‰ç«¯ä½¿ç”¨ Tailwind CSS ä¿è¯äº†ç•Œé¢çš„ç¾è§‚ä¸å“åº”å¼ã€‚
  * **é«˜æ•ˆæ•°æ®åº“æŸ¥è¯¢**: æ‰€æœ‰çš®è‚¤æ•°æ®é¢„å¤„ç†åå­˜å…¥ SQLite æ•°æ®åº“ï¼Œå¹¶å»ºç«‹äº†æ‹¼éŸ³ç´¢å¼•ï¼Œç¡®ä¿äº†é«˜æ•ˆçš„æœç´¢å“åº”é€Ÿåº¦ã€‚

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

  * **åç«¯**: Flask, Gunicorn
  * **æ•°æ®åº“**: SQLite
  * **æ‹¼éŸ³å¤„ç†**: `pypinyin`
  * **æ•°æ®æŠ“å–**: `requests`, `BeautifulSoup4`
  * **å‰ç«¯**: HTML5, Tailwind CSS, Chart.js, Luxon.js, Font Awesome, Vanilla JavaScript
  * **é…ç½®**: TOML

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
d5collect/
â”œâ”€â”€ run.py                    # åº”ç”¨å…¥å£
â”œâ”€â”€ app/                      # ä¸»åº”ç”¨æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py           # Flaskåº”ç”¨å·¥å‚
â”‚   â”œâ”€â”€ config.py             # ç¯å¢ƒé…ç½®
â”‚   â””â”€â”€ routes/               # è·¯ç”±è“å›¾
â”‚       â”œâ”€â”€ main.py           # ä¸»ç«™è·¯ç”±
â”‚       â””â”€â”€ dashboard.py      # Dashboardè·¯ç”±
â”œâ”€â”€ database/                 # æ•°æ®åº“æ¨¡å—
â”‚   â”œâ”€â”€ models.py             # æ•°æ®åº“æ¨¡å‹ä¸æ“ä½œå‡½æ•°
â”‚   â””â”€â”€ migrations/           # æ•°æ®åº“è¿ç§»è„šæœ¬
â”œâ”€â”€ data/                     # æ•°æ®æ–‡ä»¶
â”‚   â””â”€â”€ costumes_data.json    # åŸå§‹çš®è‚¤æ•°æ®
â”œâ”€â”€ scripts/                  # è¾…åŠ©è„šæœ¬
â”‚   â””â”€â”€ update_data.py        # æ•°æ®æ›´æ–°è„šæœ¬
â”œâ”€â”€ deployment/               # éƒ¨ç½²é…ç½®
â”‚   â””â”€â”€ gunicorn_config.py    # Gunicornç”Ÿäº§ç¯å¢ƒé…ç½®
â”œâ”€â”€ templates/                # HTMLæ¨¡æ¿
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ login.html
â”‚   â””â”€â”€ dashboard.html
â”œâ”€â”€ requirements.txt          # Pythonä¾èµ–
â””â”€â”€ main_config.toml          # (éœ€æ‰‹åŠ¨åˆ›å»º)ä¸»é…ç½®æ–‡ä»¶
```

## ğŸš€ å®‰è£…ä¸å¯åŠ¨

#### 1\. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/Wangnov/d5collect.git
cd d5collect
```

#### 2\. åˆ›å»ºå¹¶æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ

```bash
# Windows
python -m venv .venv
.venv\Scripts\activate

# macOS / Linux
python3 -m venv .venv
source .venv/bin/activate
```

#### 3\. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

#### 4\. é…ç½®åº”ç”¨

åº”ç”¨éœ€è¦ä¸€ä¸ªä¸»é…ç½®æ–‡ä»¶æ¥è®¾ç½® Dashboard çš„ç™»å½•å‡­æ®ã€‚æ‚¨éœ€è¦ä»æ¨¡æ¿æ–‡ä»¶å¤åˆ¶ä¸€ä»½ã€‚

```bash
# ä»æ¨¡æ¿å¤åˆ¶ä¸€ä»½é…ç½®æ–‡ä»¶
cp main_config_template.toml main_config.toml
```

ç„¶åæ‰“å¼€ `main_config.toml` æ–‡ä»¶ï¼Œ**åŠ¡å¿…ä¿®æ”¹**é»˜è®¤çš„ `password`ã€‚

```toml
[dashboard]
username = "admin"
password = "your_strong_password_here"
```

#### 5\. åˆå§‹åŒ–æ•°æ®åº“

é¦–æ¬¡è¿è¡Œæ—¶ï¼Œéœ€è¦åˆ›å»ºå¹¶å¡«å……æ•°æ®åº“ã€‚æ­¤è„šæœ¬ä¼šè¯»å– `data/costumes_data.json` å¹¶å°†å…¶è½½å…¥ SQLiteã€‚

```bash
python database/migrations/migrate_costumes.py
```

#### 6\. è¿è¡Œåº”ç”¨

  * **å¼€å‘ç¯å¢ƒ**:

    ```bash
    python run.py
    ```

    åº”ç”¨å°†åœ¨ `http://127.0.0.1:9877` ä¸Šè¿è¡Œã€‚

  * **ç”Ÿäº§ç¯å¢ƒ (æ¨è)**:
    ä½¿ç”¨ Gunicorn å¯åŠ¨ï¼Œå®ƒä¼šè¯»å– `deployment/gunicorn_config.py` ä¸­çš„é…ç½®ã€‚

    ```bash
    gunicorn -c deployment/gunicorn_config.py run:app
    ```

    åº”ç”¨å°†åœ¨ `http://127.0.0.1:9876` ä¸Šè¿è¡Œã€‚

  * **è®¿é—®åº”ç”¨**:

      * ä¸»ç«™: `http://<your_ip>:<port>/`
      * åå°: `http://<your_ip>:<port>/dashboard`

## ğŸ“Š æ•°æ®ç®¡ç†

æœ¬åº”ç”¨çš„æ•°æ®æµæ˜¯ç‹¬ç«‹çš„ï¼Œä»¥ç¡®ä¿æ•°æ®çš„å‡†ç¡®æ€§å’Œæ—¶æ•ˆæ€§ã€‚

1.  **æŠ“å–æ–°æ•°æ®**:
    è¿è¡Œ `update_data.py` è„šæœ¬ï¼Œå®ƒä¼šä» BWIKI æŠ“å–æœ€æ–°çš„çš®è‚¤æ•°æ®å¹¶ä¿å­˜åˆ° `costumes_data_updated.json`ã€‚

    ```bash
    python scripts/update_data.py
    ```

2.  **æ›´æ–°æœ¬åœ°æ•°æ®**:
    æŠ“å–å®Œæˆåï¼Œç”¨æ–°ç”Ÿæˆçš„ `costumes_data_updated.json` æ–‡ä»¶**è¦†ç›–**åŸæœ‰çš„ `data/costumes_data.json`ã€‚

3.  **åŒæ­¥åˆ°æ•°æ®åº“**:
    å†æ¬¡è¿è¡Œæ•°æ®åº“è¿ç§»è„šæœ¬ï¼Œå°†æ›´æ–°åçš„ JSON æ•°æ®åŒæ­¥åˆ° SQLite æ•°æ®åº“ä¸­ã€‚

    ```bash
    python database/migrations/migrate_costumes.py
    ```

## ğŸ¤ è´¡çŒ®

æ¬¢è¿é€šè¿‡ Fork å’Œ Pull Request çš„æ–¹å¼ä¸ºæœ¬é¡¹ç›®åšå‡ºè´¡çŒ®ã€‚å¦‚æœæ‚¨å‘ç°äº† Bug æˆ–æœ‰ä»»ä½•å»ºè®®ï¼Œè¯·éšæ—¶æäº¤ Issueã€‚

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT](https://opensource.org/licenses/MIT) è®¸å¯è¯ã€‚