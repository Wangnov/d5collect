<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>çš®è‚¤æŸ¥è¯¢</title>
    <link rel="icon" type="image/png" href="https://webinput.nie.netease.com/img/id5/icon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            500: '#6366f1',
                            600: '#4f46e5',
                        }
                    },
                    backgroundImage: {
                        'gradient-purple-blue': 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                        'gradient-purple-blue-hover': 'linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%)'
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-gray-50 min-h-screen font-sans antialiased flex flex-col">
    <!-- æ‚¬æµ®æŒ‰é’®ç»„ -->
    <div class="fixed bottom-4 right-4 z-50">
        <div id="floatingButtonGroup" class="flex flex-col items-end space-y-2">
            <!-- å±•å¼€/æŠ˜å æŒ‰é’® -->
            <button id="toggleButton"
                class="bg-gradient-purple-blue hover:bg-gradient-purple-blue-hover text-white rounded-full p-2 shadow-lg transition-all duration-300 hover:scale-105">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 15l-7-7-7 7" />
                </svg>
            </button>

            <!-- æŒ‰é’®ç»„ (é»˜è®¤éšè—) -->
            <div id="buttonList" class="hidden flex flex-col space-y-2 transition-all duration-300">
                <!-- å¸®åŠ©æŒ‰é’® -->
                <button id="helpButton"
                    class="bg-gradient-purple-blue hover:bg-gradient-purple-blue-hover text-white rounded-full p-2 shadow-lg transition-all duration-300 hover:scale-105">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </button>

                <!-- è”ç³»æˆ‘æŒ‰é’® -->
                <button id="contactButton"
                    class="bg-gradient-purple-blue hover:bg-gradient-purple-blue-hover text-white rounded-full p-2 shadow-lg transition-all duration-300 hover:scale-105">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- å¸®åŠ©å¼¹çª— -->
    <div id="helpModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-y-auto">
            <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 rounded-t-2xl">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-900">ä½¿ç”¨å¸®åŠ©</h2>
                    <button class="closeModal text-gray-400 hover:text-gray-600 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
            </div>
            <div class="px-6 py-6">
                <div class="prose prose-gray max-w-none">
                    <h3 class="text-lg font-semibold text-gray-900 mb-3">ğŸ¯ å·¥å…·ç®€ä»‹</h3>
                    <p class="text-gray-700 mb-4">è¿™æ˜¯ä¸€ä¸ªç¬¬äº”äººæ ¼çš„çš®è‚¤æŸ¥è¯¢å·¥å…·ï¼Œå¯ä»¥æ ¹æ®æ‚¨è¾“å…¥çš„æ–‡å­—ï¼Œå¿«é€Ÿæ‰¾åˆ°ä»¥æ¯ä¸ªå­—çš„ç›¸åŒæ‹¼éŸ³å¼€å¤´çš„æ¸¸æˆçš®è‚¤ã€‚</p>

                    <h3 class="text-lg font-semibold text-gray-900 mb-3">ğŸ“ ä½¿ç”¨æ–¹æ³•</h3>
                    <ol class="list-decimal list-inside text-gray-700 space-y-2 mb-4">
                        <li><strong>è¾“å…¥æ–‡å­—ï¼š</strong>åœ¨æœç´¢æ¡†ä¸­è¾“å…¥æ‚¨æƒ³è¦æŸ¥æ‰¾çš„æ–‡å­—æˆ–å¥å­</li>
                        <li><strong>ç‚¹å‡»æŸ¥æ‰¾ï¼š</strong>ç‚¹å‡»"æŸ¥æ‰¾"æŒ‰é’®å¼€å§‹æœç´¢</li>
                        <li><strong>æŸ¥çœ‹ç»“æœï¼š</strong>ç³»ç»Ÿä¼šæ˜¾ç¤ºæ‰€æœ‰åŒ¹é…çš„çš®è‚¤ï¼ŒæŒ‰å­—ç¬¦åˆ†ç»„å±•ç¤ºï¼Œæ¯è¡Œèƒ½å±•ç¤ºçš„å­—ç¬¦æœ‰é™ï¼Œæ»šåŠ¨åˆ°ä¸‹æ–¹æ¥æŸ¥çœ‹å…¶ä»–å­—ç¬¦çš„æŸ¥è¯¢ç»“æœ</li>
                    </ol>

                    <h3 class="text-lg font-semibold text-gray-900 mb-3">ğŸ” ç­›é€‰åŠŸèƒ½</h3>
                    <ul class="list-disc list-inside text-gray-700 space-y-2 mb-4">
                        <li><strong>å“è´¨ç­›é€‰ï¼š</strong>å¯ä»¥æŒ‰çš®è‚¤å“è´¨è¿›è¡Œç­›é€‰ï¼ˆç»¿ã€è“ã€ç´«ã€é‡‘ã€è™šå¦„ï¼‰</li>
                        <li><strong>è§’è‰²ç­›é€‰ï¼š</strong>å¯ä»¥æŒ‰æ¸¸æˆè§’è‰²è¿›è¡Œç­›é€‰ï¼ˆåªèƒ½ç­›é€‰æŸ¥è¯¢åˆ°çš„è§’è‰²ï¼‰</li>
                        <li><strong>å¤šé€‰æ”¯æŒï¼š</strong>æ”¯æŒåŒæ—¶é€‰æ‹©å¤šä¸ªç­›é€‰æ¡ä»¶</li>
                        <li><strong>æœç´¢åŠŸèƒ½ï¼š</strong>åœ¨ç­›é€‰æ¡†ä¸­å¯ä»¥è¾“å…¥å…³é”®è¯å¿«é€Ÿå®šä½</li>
                    </ul>

                    <h3 class="text-lg font-semibold text-gray-900 mb-3">ğŸ’¡ ä½¿ç”¨æŠ€å·§</h3>
                    <ul class="list-disc list-inside text-gray-700 space-y-2 mb-4">
                        <li>ç¬¬äº”äººæ ¼çš„çš®è‚¤æ€»æ•°æœ‰é™ï¼Œå¹¶ä¸èƒ½ä¿è¯æœç´¢åˆ°æ‰€æœ‰é€‚åˆçš„ç»“æœã€‚å½“æœç´¢ä¸åˆ°æƒ³è¦çš„çš®è‚¤æ—¶ï¼Œä¾‹å¦‚â€œæˆ‘â€å­—ç›®å‰æ²¡æœ‰å¯åŒ¹é…çš„çš®è‚¤ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨â€œå¶â€æˆ–â€œMEâ€ä»£æ›¿</li>
                        <li>æ”¯æŒä¸­æ–‡æ‹¼éŸ³åŒ¹é…ï¼Œæ— éœ€æ‹…å¿ƒå£°è°ƒ</li>
                        <li>æ”¯æŒè‹±æ–‡å­—æ¯åŒ¹é…ï¼Œä¼šåŒ¹é…åˆ°ä»¥è‹±æ–‡å­—æ¯å¼€å¤´çš„çš®è‚¤</li>
                        <li>é»„è‰²é«˜äº®çš„çš®è‚¤è¡¨ç¤ºå®Œå…¨åŒ¹é…æŸ¥è¯¢çš„å­—</li>
                        <li>ç‚¹å‡»çš®è‚¤å›¾ç‰‡å¯ä»¥è·³è½¬åˆ°ç¬¬äº”äººæ ¼BWIKIçš„çš®è‚¤è¯¦ç»†é¡µé¢</li>
                    </ul>

                    <h3 class="text-lg font-semibold text-gray-900 mb-3">ğŸ“± ç•Œé¢è¯´æ˜</h3>
                    <ul class="list-disc list-inside text-gray-700 space-y-2 mb-6">
                        <li><strong>æœç´¢åŒºåŸŸï¼š</strong>é¡µé¢é¡¶éƒ¨çš„è¾“å…¥æ¡†å’ŒæŸ¥æ‰¾æŒ‰é’®</li>
                        <li><strong>ç­›é€‰åŒºåŸŸï¼š</strong>ç»“æœé¡µé¢ä¸Šæ–¹çš„å“è´¨å’Œè§’è‰²ç­›é€‰å™¨</li>
                        <li><strong>ç»“æœåŒºåŸŸï¼š</strong>ä»¥ç½‘æ ¼å½¢å¼å±•ç¤ºåŒ¹é…çš„çš®è‚¤</li>
                        <li><strong>çš®è‚¤å¡ç‰‡ï¼š</strong>æ˜¾ç¤ºçš®è‚¤å›¾ç‰‡ã€è§’è‰²åç§°å’Œå“è´¨ä¿¡æ¯</li>
                    </ul>

                    <div class="border-t border-gray-200 pt-6 mt-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-3">ğŸ“š æ•°æ®æ¥æº</h3>
                        <p class="text-gray-700 mb-2">æœ¬å·¥å…·çš„çš®è‚¤æ•°æ®æ¥æºäºï¼š</p>
                        <div class="flex items-center space-x-2 mb-4">
                            <i class="fas fa-external-link-alt text-primary-600"></i>
                            <a href="https://wiki.biligame.com/dwrg/%E6%97%B6%E8%A3%85" target="_blank"
                                class="text-primary-600 hover:text-primary-700 transition-colors font-medium">
                                ç¬¬äº”äººæ ¼BWIKI - æ—¶è£…é¡µé¢
                            </a>
                        </div>

                        <h3 class="text-lg font-semibold text-gray-900 mb-3">ğŸ™ è‡´è°¢</h3>
                        <p class="text-gray-700 text-sm">
                            æ„Ÿè°¢ç¬¬äº”äººæ ¼BWIKIæä¾›çš„è¯¦ç»†çš®è‚¤æ•°æ®ï¼Œæ„Ÿè°¢æ‰€æœ‰ä¸ºæ¸¸æˆèµ„æ–™æ•´ç†åšå‡ºè´¡çŒ®çš„ç©å®¶å’Œç¼–è¾‘è€…ä»¬ã€‚
                            æœ¬å·¥å…·ä»…ä¾›å­¦ä¹ äº¤æµä½¿ç”¨ï¼Œæ‰€æœ‰æ¸¸æˆå†…å®¹ç‰ˆæƒå½’ç½‘æ˜“å…¬å¸æ‰€æœ‰ã€‚
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- è”ç³»æˆ‘å¼¹çª— -->
    <div id="contactModal"
        class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-y-auto">
            <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 rounded-t-2xl">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-900">è”ç³»æˆ‘</h2>
                    <button class="closeModal text-gray-400 hover:text-gray-600 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
            </div>
            <div class="px-6 py-6">
                <div class="prose prose-gray max-w-none">
                    <h3 class="text-lg font-semibold text-gray-900 mb-3">ğŸ‘‹ å…³äºä½œè€…</h3>
                    <p class="text-gray-700 mb-4">å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ç…ä¸»ï¼Œè¿™ä¸ªå·¥å…·æ˜¯æˆ‘ä¸ºç¬¬äº”äººæ ¼ç©å®¶å¼€å‘çš„å°å·¥å…·ï¼Œå¸Œæœ›èƒ½å¸®åŠ©å¤§å®¶æ›´æ–¹ä¾¿åœ°æŸ¥æ‰¾çš®è‚¤ã€‚</p>

                    <h3 class="text-lg font-semibold text-gray-900 mb-3">ğŸ”— å…³æ³¨æˆ‘</h3>
                    <div class="space-y-4 mb-4">
                        <div class="flex items-center space-x-3">
                            <i class="fab fa-github text-2xl text-gray-800"></i>
                            <div>
                                <strong class="text-gray-900">GitHubï¼š</strong>
                                <a href="https://github.com/Wangnov/d5collect" target="_blank"
                                    class="text-primary-600 hover:text-primary-700 transition-colors ml-2">
                                    ç‚¹å‡»è·³è½¬
                                </a>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-book text-2xl text-red-500"></i>
                            <div>
                                <strong class="text-gray-900">å°çº¢ä¹¦ï¼š</strong>
                                <a href="https://www.xiaohongshu.com/user/profile/60121ea50000000001008e60"
                                    target="_blank"
                                    class="text-primary-600 hover:text-primary-700 transition-colors ml-2">
                                    ç‚¹å‡»è·³è½¬
                                </a>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3">
                            <i class="fab fa-tiktok text-2xl text-black"></i>
                            <div>
                                <strong class="text-gray-900">æŠ–éŸ³ï¼š</strong>
                                <a href="https://v.douyin.com/sBdMXTK841o" target="_blank"
                                    class="text-primary-600 hover:text-primary-700 transition-colors ml-2">
                                    ç‚¹å‡»è·³è½¬
                                </a>
                            </div>
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold text-gray-900 mb-3">ğŸ’¬ åé¦ˆä¸å»ºè®®</h3>
                    <p class="text-gray-700">å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜ã€å»ºè®®æˆ–åé¦ˆï¼Œæ¬¢è¿é€šè¿‡ä»¥ä¸Šæ¸ é“è”ç³»æˆ‘ï¼Œæˆ‘ä¼šå°½å¿«å›å¤ã€‚æ„Ÿè°¢æ‚¨çš„æ”¯æŒï¼</p>
                </div>
            </div>
        </div>
    </div>
    <main>
    <div class="container mx-auto px-4 py-8 max-w-5xl">
        <div class="text-center mb-10">
            <h1 class="text-4xl font-extrabold text-gray-900 mb-2">è°éŸ³å­—çš®è‚¤æŸ¥è¯¢</h1>
            <p class="text-gray-500">è¾“å…¥ä¸€å¥è¯ï¼Œå¿«é€ŸæŸ¥æ‰¾åˆ°è°éŸ³å­—å¼€å¤´çš„çš®è‚¤</p>
        </div>

        <form id="searchForm" method="POST" class="mb-12 bg-white rounded-2xl shadow-lg p-8 border border-gray-100">
            <div class="flex flex-col sm:flex-row gap-4">
                <input type="text" name="input_text" placeholder="è¾“å…¥ä½ æƒ³æŸ¥æ‰¾çš„è¯..." autocomplete="off"
                    class="flex-1 px-5 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-gray-800 text-lg transition duration-200 ease-in-out">
                <button type="submit"
                    class="px-8 py-3 bg-gradient-purple-blue hover:bg-gradient-purple-blue-hover text-white rounded-xl transition-all duration-300 font-semibold text-lg shadow-md">
                    æŸ¥æ‰¾
                </button>
            </div>
        </form>

        <!-- åŠ è½½åŠ¨ç”»è¦†ç›–å±‚ -->
        <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-xl p-8 shadow-2xl flex flex-col items-center">
                <div class="loading-spinner mb-4"></div>
                <p class="text-gray-700 font-medium">åŠ è½½ä¸­...</p>
            </div>
        </div>

        {% if input_text %}
        <div class="space-y-8 bg-white rounded-2xl shadow-lg p-8 border border-gray-100">
            <h2 class="text-2xl font-bold text-gray-900">æŸ¥è¯¢ç»“æœ</h2>

            <div class="flex flex-row gap-4 mb-6">
                <!-- å“è´¨ç­›é€‰ - å¤šé€‰ä¸‹æ‹‰ -->
                <div class="relative w-1/2">
                    <div class="flex flex-wrap items-center gap-2 p-3 border border-gray-300 rounded-xl bg-white min-h-[50px] cursor-pointer shadow-sm"
                        id="qualityTags">
                        <input type="text" id="qualitySearch" placeholder="ç­›é€‰å“è´¨..."
                            class="flex-1 min-w-[60px] outline-none text-gray-700 py-1 bg-transparent">
                    </div>
                    <div id="qualityDropdown"
                        class="absolute z-10 mt-2 w-full bg-white border border-gray-200 rounded-xl shadow-xl hidden max-h-60 overflow-y-auto">
                        <div class="p-2">
                            <div class="flex items-center gap-2 p-2 hover:bg-primary-50 rounded-lg cursor-pointer transition-colors duration-200"
                                data-value="">
                                <input type="checkbox" id="qualityAll"
                                    class="h-5 w-5 text-primary-600 rounded focus:ring-primary-500">
                                <label for="qualityAll" class="cursor-pointer flex-1 text-gray-800">æ‰€æœ‰å“è´¨</label>
                            </div>
                            <!-- å“è´¨é€‰é¡¹å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                        </div>
                    </div>
                </div>

                <!-- è§’è‰²ç­›é€‰ - å¤šé€‰ä¸‹æ‹‰ -->
                <div class="relative w-1/2">
                    <div class="flex flex-wrap items-center gap-2 p-3 border border-gray-300 rounded-xl bg-white min-h-[50px] cursor-pointer shadow-sm"
                        id="characterTags">
                        <input type="text" id="characterSearch" placeholder="ç­›é€‰è§’è‰²..."
                            class="flex-1 min-w-[50px] outline-none text-gray-700 py-1 bg-transparent">
                    </div>
                    <div id="characterDropdown"
                        class="absolute z-10 mt-2 w-full bg-white border border-gray-200 rounded-xl shadow-xl hidden max-h-60 overflow-y-auto">
                        <div class="p-2">
                            <div class="flex items-center gap-2 p-2 hover:bg-primary-50 rounded-lg cursor-pointer transition-colors duration-200"
                                data-value="">
                                <input type="checkbox" id="characterAll"
                                    class="h-5 w-5 text-primary-600 rounded focus:ring-primary-500">
                                <label for="characterAll" class="cursor-pointer flex-1 text-gray-800">æ‰€æœ‰è§’è‰²</label>
                            </div>
                            <!-- è§’è‰²é€‰é¡¹å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                        </div>
                    </div>
                </div>
            </div>

            <div
                class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6 max-h-[500px] overflow-y-auto pb-4 px-4 custom-scrollbar">
                {% for char, costumes in result %}
                <div class="flex flex-col items-center">
                    <div class="text-xl font-semibold text-gray-800 mb-4">{{ char }}</div>

                    <div class="w-full space-y-4">
                        {% for costume in costumes %}
                        <div class="{% if costume.exact_match %}bg-gradient-to-r from-amber-50 to-amber-100 shadow-lg ring-2 ring-amber-300{% else %}bg-white shadow-md ring-1 ring-gray-200{% endif %} p-4 rounded-xl hover:shadow-xl transition-all duration-300 min-w-[100px] transform hover:-translate-y-1 cursor-pointer"
                            data-id="{{ costume.name }}">
                            <a href="{{ costume.wiki_url }}" target="_blank" class="block">
                                <img src="{{ costume.image_url }}" alt="{{ costume.name }}"
                                    class="w-full h-auto rounded-lg object-contain aspect-square hover:scale-105 transition-transform duration-300">
                            </a>
                            <div class="mt-4 text-center">
                                <p class="text-base font-semibold text-gray-800 truncate">{{ costume.character }}</p>
                                <p class="text-sm text-gray-500 mt-1">{{ costume.quality_name }}</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
    </main>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // æå–æ‰€æœ‰å“è´¨å’Œè§’è‰²é€‰é¡¹
            const costumes = [];

            // ç­‰å¾…DOMå®Œå…¨åŠ è½½åå†è·å–æ‰€æœ‰å¡ç‰‡å…ƒç´ 
            setTimeout(() => {
                // è·å–æ‰€æœ‰å¡ç‰‡å…ƒç´ 
                const cardElements = document.querySelectorAll('div[data-id]');

                // éå†æ‰€æœ‰å¡ç‰‡å…ƒç´ å¹¶æ·»åŠ åˆ°costumesæ•°ç»„
                cardElements.forEach(element => {
                    const id = element.dataset.id;
                    const character = element.querySelector('.text-base.font-semibold').textContent;
                    const quality_name = element.querySelector('.text-sm.text-gray-500').textContent;

                    costumes.push({
                        id: id,
                        quality_name: quality_name,
                        character: character,
                        element: element
                    });
                });

                // åˆå§‹åŒ–ç­›é€‰ä¸‹æ‹‰èœå•
                initializeFilters();
            }, 100);

            // åˆå§‹åŒ–ç­›é€‰çŠ¶æ€
            const filters = {
                quality: [],
                character: []
            };

            // è·å–DOMå…ƒç´ 
            const qualityTags = document.getElementById('qualityTags');
            const qualityDropdown = document.getElementById('qualityDropdown');
            const qualitySearch = document.getElementById('qualitySearch');
            const qualityAll = document.getElementById('qualityAll');

            const characterTags = document.getElementById('characterTags');
            const characterDropdown = document.getElementById('characterDropdown');
            const characterSearch = document.getElementById('characterSearch');
            const characterAll = document.getElementById('characterAll');

            // åˆå§‹åŒ–ç­›é€‰å™¨å‡½æ•°
            function initializeFilters() {

                // å¡«å……å“è´¨ä¸‹æ‹‰èœå•
                const qualitySet = new Set();
                costumes.forEach(c => qualitySet.add(c.quality_name));
                const qualityOptions = Array.from(qualitySet);

                qualityOptions.forEach(quality => {
                    const optionId = `quality-${quality.replace(/\s+/g, '-')}`;
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'flex items-center gap-2 p-2 hover:bg-primary-50 rounded-lg cursor-pointer transition-colors duration-200';
                    optionDiv.dataset.value = quality;
                    optionDiv.innerHTML = `
                    <input type="checkbox" id="${optionId}" class="h-5 w-5 text-primary-600 rounded focus:ring-primary-500">
                    <label for="${optionId}" class="cursor-pointer flex-1 text-gray-800">${quality}</label>
                `;
                    qualityDropdown.querySelector('div').appendChild(optionDiv);

                    // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                    optionDiv.addEventListener('click', function (e) {
                        const checkbox = this.querySelector('input[type="checkbox"]');
                        checkbox.checked = !checkbox.checked;

                        if (checkbox.checked) {
                            addFilter('quality', quality);
                        } else {
                            removeFilter('quality', quality);
                        }

                        e.stopPropagation();
                    });
                });

                // å¡«å……è§’è‰²ä¸‹æ‹‰èœå•
                const characterSet = new Set();
                costumes.forEach(c => characterSet.add(c.character));
                const characterOptions = Array.from(characterSet);

                characterOptions.forEach(character => {
                    const optionId = `character-${character.replace(/\s+/g, '-')}`;
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'flex items-center gap-2 p-2 hover:bg-primary-50 rounded-lg cursor-pointer transition-colors duration-200';
                    optionDiv.dataset.value = character;
                    optionDiv.innerHTML = `
                    <input type="checkbox" id="${optionId}" class="h-5 w-5 text-primary-600 rounded focus:ring-primary-500">
                    <label for="${optionId}" class="cursor-pointer flex-1 text-gray-800">${character}</label>
                `;
                    characterDropdown.querySelector('div').appendChild(optionDiv);

                    // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                    optionDiv.addEventListener('click', function (e) {
                        const checkbox = this.querySelector('input[type="checkbox"]');
                        checkbox.checked = !checkbox.checked;

                        if (checkbox.checked) {
                            addFilter('character', character);
                        } else {
                            removeFilter('character', character);
                        }

                        e.stopPropagation();
                    });
                });

                // å…¨é€‰/å–æ¶ˆå…¨é€‰å“è´¨
                qualityAll.parentElement.addEventListener('click', function (e) {
                    const isChecked = !qualityAll.checked;
                    qualityAll.checked = isChecked;

                    const checkboxes = qualityDropdown.querySelectorAll('input[type="checkbox"]:not(#qualityAll)');
                    checkboxes.forEach(cb => {
                        cb.checked = isChecked;
                    });

                    if (isChecked) {
                        // å…¨é€‰
                        filters.quality = [...qualityOptions];
                    } else {
                        // å–æ¶ˆå…¨é€‰
                        filters.quality = [];
                    }

                    updateTags('quality');
                    applyFilters();
                    e.stopPropagation();
                });

                // å…¨é€‰/å–æ¶ˆå…¨é€‰è§’è‰²
                characterAll.parentElement.addEventListener('click', function (e) {
                    const isChecked = !characterAll.checked;
                    characterAll.checked = isChecked;

                    const checkboxes = characterDropdown.querySelectorAll('input[type="checkbox"]:not(#characterAll)');
                    checkboxes.forEach(cb => {
                        cb.checked = isChecked;
                    });

                    if (isChecked) {
                        // å…¨é€‰
                        filters.character = [...characterOptions];
                    } else {
                        // å–æ¶ˆå…¨é€‰
                        filters.character = [];
                    }

                    updateTags('character');
                    applyFilters();
                    e.stopPropagation();
                });

                // ç‚¹å‡»è¾“å…¥æ¡†æ˜¾ç¤ºä¸‹æ‹‰èœå•
                qualitySearch.addEventListener('click', function (e) {
                    qualityDropdown.classList.remove('hidden');
                    characterDropdown.classList.add('hidden');
                    e.stopPropagation();
                });

                qualityTags.addEventListener('click', function (e) {
                    qualityDropdown.classList.remove('hidden');
                    characterDropdown.classList.add('hidden');
                    qualitySearch.focus();
                    e.stopPropagation();
                });

                characterSearch.addEventListener('click', function (e) {
                    characterDropdown.classList.remove('hidden');
                    qualityDropdown.classList.add('hidden');
                    e.stopPropagation();
                });

                characterTags.addEventListener('click', function (e) {
                    characterDropdown.classList.remove('hidden');
                    qualityDropdown.classList.add('hidden');
                    characterSearch.focus();
                    e.stopPropagation();
                });

                // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­ä¸‹æ‹‰èœå•
                document.addEventListener('click', function () {
                    qualityDropdown.classList.add('hidden');
                    characterDropdown.classList.add('hidden');
                });

                // æœç´¢åŠŸèƒ½
                qualitySearch.addEventListener('input', function () {
                    const searchText = this.value.toLowerCase();
                    const options = qualityDropdown.querySelectorAll('div[data-value]:not([data-value=""])');

                    options.forEach(option => {
                        const value = option.dataset.value.toLowerCase();
                        if (value.includes(searchText)) {
                            option.style.display = 'flex';
                        } else {
                            option.style.display = 'none';
                        }
                    });
                });

                characterSearch.addEventListener('input', function () {
                    const searchText = this.value.toLowerCase();
                    const options = characterDropdown.querySelectorAll('div[data-value]:not([data-value=""])');

                    options.forEach(option => {
                        const value = option.dataset.value.toLowerCase();
                        if (value.includes(searchText)) {
                            option.style.display = 'flex';
                        } else {
                            option.style.display = 'none';
                        }
                    });
                });

                // æ·»åŠ ç­›é€‰æ¡ä»¶
                function addFilter(type, value) {
                    if (!filters[type].includes(value)) {
                        filters[type].push(value);
                        updateTags(type);
                        applyFilters();
                    }
                }

                // ç§»é™¤ç­›é€‰æ¡ä»¶
                function removeFilter(type, value) {
                    const index = filters[type].indexOf(value);
                    if (index !== -1) {
                        filters[type].splice(index, 1);
                        updateTags(type);
                        applyFilters();
                    }
                }

                // æ›´æ–°æ ‡ç­¾æ˜¾ç¤º
                function updateTags(type) {
                    const container = type === 'quality' ? qualityTags : characterTags;
                    const search = type === 'quality' ? qualitySearch : characterSearch;

                    // ç§»é™¤ç°æœ‰æ ‡ç­¾
                    const existingTags = container.querySelectorAll('.filter-tag');
                    existingTags.forEach(tag => tag.remove());

                    // æ·»åŠ æ–°æ ‡ç­¾
                    filters[type].forEach(value => {
                        const tag = document.createElement('div');
                        tag.className = 'filter-tag flex items-center bg-primary-500 text-white text-sm rounded-full px-3 py-1';
                        tag.innerHTML = `
                        <span class="mr-1">${value}</span>
                        <button type="button" class="text-white hover:text-gray-200 focus:outline-none" data-value="${value}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    `;

                        // æ·»åŠ åˆ é™¤äº‹ä»¶
                        tag.querySelector('button').addEventListener('click', function (e) {
                            removeFilter(type, this.dataset.value);
                            e.stopPropagation();
                        });

                        container.insertBefore(tag, search);
                    });

                    // æ›´æ–°å…¨é€‰å¤é€‰æ¡†çŠ¶æ€
                    const allCheckbox = type === 'quality' ? qualityAll : characterAll;
                    const options = type === 'quality' ? qualityOptions : characterOptions;

                    if (filters[type].length === options.length) {
                        allCheckbox.checked = true;
                    } else {
                        allCheckbox.checked = false;
                    }
                }

                // åº”ç”¨ç­›é€‰
                function applyFilters() {
                    costumes.forEach(costume => {
                        const matchesQuality = filters.quality.length === 0 || filters.quality.includes(costume.quality_name);
                        const matchesCharacter = filters.character.length === 0 || filters.character.includes(costume.character);

                        if (matchesQuality && matchesCharacter) {
                            costume.element.style.display = 'block';
                        } else {
                            costume.element.style.display = 'none';
                        }
                    });
                }
            } // å…³é—­initializeFilterså‡½æ•°
        });

        // æ‚¬æµ®æŒ‰é’®ç»„åŠŸèƒ½
        const toggleButton = document.getElementById('toggleButton');
        const buttonList = document.getElementById('buttonList');
        const helpButton = document.getElementById('helpButton');
        const contactButton = document.getElementById('contactButton');
        const helpModal = document.getElementById('helpModal');
        const contactModal = document.getElementById('contactModal');
        const closeButtons = document.querySelectorAll('.closeModal');

        // å±•å¼€/æŠ˜å æŒ‰é’®ç»„
        toggleButton.addEventListener('click', function () {
            buttonList.classList.toggle('hidden');
            // åˆ‡æ¢ç®­å¤´æ–¹å‘
            const svg = this.querySelector('svg path');
            if (buttonList.classList.contains('hidden')) {
                svg.setAttribute('d', 'M19 15l-7-7-7 7'); // å‘ä¸Šç®­å¤´ï¼ˆéšè—æ—¶æ˜¾ç¤ºå‘ä¸Šï¼Œè¡¨ç¤ºå¯å±•å¼€ï¼‰
            } else {
                svg.setAttribute('d', 'M19 9l-7 7-7-7'); // å‘ä¸‹ç®­å¤´ï¼ˆæ˜¾ç¤ºæ—¶æ˜¾ç¤ºå‘ä¸‹ï¼Œè¡¨ç¤ºå¯æ”¶èµ·ï¼‰
            }
        });

        // æ‰“å¼€å¸®åŠ©å¼¹çª—
        helpButton.addEventListener('click', function () {
            helpModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨
        });

        // æ‰“å¼€è”ç³»æˆ‘å¼¹çª—
        contactButton.addEventListener('click', function () {
            contactModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨
        });

        // å…³é—­æ‰€æœ‰å¼¹çª—
        function closeAllModals() {
            helpModal.classList.add('hidden');
            contactModal.classList.add('hidden');
            document.body.style.overflow = 'auto'; // æ¢å¤æ»šåŠ¨
        }

        // ä¸ºæ‰€æœ‰å…³é—­æŒ‰é’®æ·»åŠ äº‹ä»¶
        closeButtons.forEach(button => {
            button.addEventListener('click', closeAllModals);
        });

        // ç‚¹å‡»å¼¹çª—èƒŒæ™¯å…³é—­
        [helpModal, contactModal].forEach(modal => {
            modal.addEventListener('click', function (e) {
                if (e.target === this) {
                    closeAllModals();
                }
            });
        });

        // ESCé”®å…³é—­å¼¹çª—
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape' && (!helpModal.classList.contains('hidden') || !contactModal.classList.contains('hidden'))) {
                closeAllModals();
            }
        })

        // åŠ è½½åŠ¨ç”»æ§åˆ¶
        function showLoading() {
            const overlay = document.getElementById('loadingOverlay');
            overlay.classList.add('show');
        }

        function hideLoading() {
            const overlay = document.getElementById('loadingOverlay');
            overlay.classList.remove('show');
        }

        // è¡¨å•æäº¤å¤„ç†
        document.getElementById('searchForm').addEventListener('submit', function(e) {
            showLoading();
            
            // ç¡®ä¿æœ€å°æ˜¾ç¤ºæ—¶é—´0.5ç§’
            const startTime = Date.now();
            
            // åœ¨å®é™…æäº¤å‰ç¡®ä¿åŠ¨ç”»å·²æ˜¾ç¤º
            setTimeout(() => {
                // è¡¨å•æ­£å¸¸æäº¤ï¼Œè¿™é‡Œä¸éœ€è¦é˜»æ­¢é»˜è®¤è¡Œä¸º
                // å› ä¸ºæˆ‘ä»¬å¸Œæœ›è¡¨å•æ­£å¸¸æäº¤åˆ°åç«¯
            }, 100);
        });
    </script>
    <style>
        /* Custom Scrollbar for Webkit browsers */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            /* gray-300 */
            border-radius: 10px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
            /* gray-400 */
        }

        /* åŠ è½½åŠ¨ç”»æ ·å¼ */
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f4f6;
            border-top: 4px solid transparent;
            border-radius: 50%;
            background: conic-gradient(from 0deg, #667eea, #764ba2, #667eea);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        #loadingOverlay {
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
            opacity: 0;
            visibility: hidden;
        }

        #loadingOverlay.show {
            opacity: 1;
            visibility: visible;
        }
    </style>

    <!-- Footer -->
    <footer class="bg-gray-100 border-t border-gray-200 py-6 mt-auto">
        <div class="container mx-auto px-4 text-center">
            <div class="flex flex-row items-center justify-center gap-2 text-sm text-gray-600">
                <a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer"
                    class="text-primary-600 hover:text-primary-700 transition-colors duration-200">
                    æ²ªICPå¤‡2021021070å·-2
                </a>
                <span class="text-gray-400">|</span>
                <span>Made with Trae by</span>
                <a href="https://v.douyin.com/sBdMXTK841o" target="_blank" rel="noopener noreferrer"
                    class="text-primary-600 hover:text-primary-700 transition-colors duration-200 font-medium">
                    ç…ä¸»
                </a>
            </div>
        </div>
    </footer>
</body>

</html>